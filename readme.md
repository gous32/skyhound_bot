## Куда я попал?

Это код Skyhound-бота.

Бот поддерживает несколько триггеров (сценариев) одновременно.

Фичи:
* Можно быстро наклепать копию бота со своим списком триггеров. Список триггеров задаётся в функции CreateTriggers. Почитайте, там простой код
* Можно легко добавлять стандартные триггеры:
    * Отправить случайную картинку из списка по какому-то условию
    * Сказать одну фразу из набора по какому-то условию
* Гибкая система условий, см. комментарий в core/filters.py
* Встроенная админка. Админ может заткнуть бота и настроить частоту срабатывания триггера

Фичи для тех, что знает слово "дескриптор":
* У триггеров из коробки есть стейт
* Можно создать условный триггер, см. FilteredTrigger
* Можно создавать сложные триггеры, состоящие из множества сценариев. Вроде пидоробота. См. MultiTrigger
* Можно просто написать свой триггер, унаследовавшись от BaseTrigger
* Есть таймер, позволяющий запустить отложенное на N секунд событие как-то так: `GetTimer().AddTaskDelta(30, lambda: print("Hohoho"))`

Больше информации в комментариях в core/trigger.py и core/filters.py

### Как запустить

python3 main.py --token="YOUR TOKEN" -v -s "STATE FILE PATH"

А потом напишите своему боту `/describe`


python3 main.py --help тоже полезная


### Как написать триггер
Для любого триггера доступны:
* self.Bot - бот, через которого можно отправлять сообщения
* self.State - json-стейт, в который можно писать изменения. Стейт сохраняется на диск и читается перед запуском

В метод Process приходят два аргумента:
* message - объект сообщения
* chat_state - стейт для пары {чат, триггер}

#### Триггер с условием
См. triggers/news.py

* Напишите класс YourSuperTrigger, унаследованный от FilteredTrigger
    * В конструктор можно передавать любые аргументы, кроме proba. Первыми аргументами должны быть magic и filters, который надо передать в super
    * В методе `Process(self, message, chat_state)` опишите поведение
* В методе CreateTriggers создайте экземпляр своего триггера через SkyhoundInstance.Register()
    * первым аргументом должен идти класс триггера
    * вторым имя триггера
    * третьим фильтр
    * все остальные аргументы as is попадают в класс
    * через proba=123 можно задавать дефолтную вероятность срабатывания

Фильтр может быть гибким, включать в себя НЕ, И и ИЛИ. Пример фильтра:
```
        flt.AnyOf([
            flt.ContainsAll(["сладк", 'булк']),
            flt.ContainsAll(["сладк", "булочк"]),
            flt.ContainsAny(["молыш", "млемик"]),
        ]),
```

### Триггер со сценариями
Почитайте triggers/bard.py.

Вкратце - можно задавать много сценариев со своими условиями и обработчиками внутри одного триггера. Удобно, если нужно реагировать одним и тем же стейтом на несколько команд.
